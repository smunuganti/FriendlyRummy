<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendly Rummy | Tournament Edition</title>
    <style>
        :root { --felt: #1a472a; --gold: #f1c40f; --card-w: 65px; --card-h: 95px; }
        body { background: var(--felt); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }

        /* --- REALISTIC CARD DESIGN --- */
        .card { 
            width: var(--card-w); height: var(--card-h); background: white; border-radius: 6px; 
            color: black; position: relative; display: flex; flex-direction: column; 
            justify-content: space-between; padding: 5px; box-sizing: border-box;
            box-shadow: 2px 4px 10px rgba(0,0,0,0.4); cursor: pointer; border: 1px solid #ccc;
            margin-left: -25px; transition: transform 0.2s, box-shadow 0.2s; user-select: none;
        }
        .card:first-child { margin-left: 0; }
        .card.red { color: #d40000; }
        .card .rank-top { align-self: flex-start; font-size: 1rem; line-height: 1; font-weight: 900; }
        .card .suit-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2rem; opacity: 0.15; }
        .card .rank-bottom { align-self: flex-end; font-size: 1rem; line-height: 1; transform: rotate(180deg); font-weight: 900; }
        
        .card.back { background: #2c3e50; border: 2px solid white; color: transparent; background-image: radial-gradient(circle, #34495e 10%, transparent 11%); background-size: 10px 10px; }
        .card.selected { transform: translateY(-30px); z-index: 100; border: 3px solid var(--gold); box-shadow: 0 10px 20px rgba(0,0,0,0.6); }

        /* --- UI COMPONENTS --- */
        #pool-board { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); padding: 12px; border-radius: 10px; border-left: 5px solid var(--gold); min-width: 160px; }
        .hp-bar { height: 6px; background: #333; border-radius: 3px; margin: 5px 0; overflow: hidden; }
        .hp-fill { height: 100%; background: var(--gold); transition: width 0.5s; }

        .table { width: 90%; height: 280px; border: 10px solid #0b2415; border-radius: 120px; display: flex; justify-content: center; align-items: center; margin: 20px; background: radial-gradient(circle, #245c36, #1a472a); box-shadow: inset 0 0 50px black; }
        .hand { display: flex; justify-content: center; padding: 20px; min-height: 120px; margin-top: 20px; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; }
        
        button { padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; background: var(--gold); color: #2c3e50; box-shadow: 0 4px #b8860b; }
        button:active { transform: translateY(2px); box-shadow: 0 1px #b8860b; }
        .btn-drop { background: #e67e22; color: white; box-shadow: 0 4px #a05819; }
        .btn-show { background: #27ae60; color: white; box-shadow: 0 4px #1e8449; }
    </style>
</head>
<body>

    <div id="pool-board">
        <strong>201 Pool Match</strong>
        <div style="font-size: 0.85rem; margin-top:5px;">You: <span id="p-score">0</span> | Oliver: <span id="b-score">0</span></div>
        <div class="hp-bar"><div id="p-fill" class="hp-fill"></div></div>
        <div id="status" style="font-size: 0.75rem; color: var(--gold);">Ready to deal...</div>
    </div>

    <div class="table">
        <div style="display: flex; gap: 30px;">
            <div id="deck" class="card back" onclick="drawFromDeck()"></div>
            <div id="discard-pile" class="card">?</div>
        </div>
    </div>

    <div class="hand" id="player-hand"></div>

    <div class="controls">
        <button onclick="groupCards()">üì¶ Group</button>
        <button class="btn-drop" id="drop-btn" onclick="handleDrop()">First Drop (20)</button>
        <button class="btn-show" onclick="declareShow()">üèÅ SHOW</button>
        <button style="background: #34495e; color: white;" onclick="autoSort()">ü™Ñ Sort</button>
    </div>

    <script>
        const suits = ['‚ô•', '‚ô¶', '‚ô£', '‚ô†'];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        const rankVal = {'A':1, '2':2, '3':3, '4':4, '5':5, '6':6, '7':7, '8':8, '9':9, '10':10, 'J':11, 'Q':12, 'K':13};
        
        let pPool = 0, bPool = 0, moves = 0;
        let pHand = [], deck = [], discard = [], selected = [];

        function init() {
            if (pPool >= 201) { alert("You hit 201. Oliver wins!"); pPool = 0; bPool = 0; }
            if (bPool >= 201) { alert("Oliver hit 201. You win!"); pPool = 0; bPool = 0; }
            
            deck = [];
            for(let i=0; i<2; i++) for(let s of suits) for(let r of ranks) deck.push({r, s, c: (s==='‚ô•'||s==='‚ô¶')?'red':'black', v: rankVal[r]});
            deck.sort(() => Math.random() - 0.5);
            pHand = deck.splice(0, 13);
            discard = [deck.pop()];
            moves = 0; selected = [];
            updateUI();
        }

        function createCardHTML(card, isSelected, index) {
            const div = document.createElement('div');
            div.className = `card ${card.c} ${isSelected ? 'selected' : ''}`;
            div.innerHTML = `
                <div class="rank-top">${card.r}<br>${card.s}</div>
                <div class="suit-center">${card.s}</div>
                <div class="rank-bottom">${card.r}<br>${card.s}</div>
            `;
            div.onclick = () => {
                const pos = selected.indexOf(index);
                if (pos > -1) selected.splice(pos, 1); else selected.push(index);
                updateUI();
            };
            return div;
        }

        function updateUI() {
            const area = document.getElementById('player-hand'); area.innerHTML = '';
            pHand.forEach((c, i) => area.appendChild(createCardHTML(c, selected.includes(i), i)));
            
            const top = discard[discard.length - 1];
            const dElem = document.getElementById('discard-pile');
            dElem.className = `card ${top.c}`;
            dElem.innerHTML = `<div class="rank-top">${top.r}<br>${top.s}</div><div class="suit-center">${top.s}</div><div class="rank-bottom">${top.r}<br>${top.s}</div>`;
            
            document.getElementById('p-score').innerText = pPool;
            document.getElementById('b-score').innerText = bPool;
            document.getElementById('p-fill').style.width = (pPool / 201 * 100) + "%";
            document.getElementById('drop-btn').innerText = moves === 0 ? "First Drop (20)" : "Middle Drop (40)";
        }

        function drawFromDeck() {
            if (pHand.length < 14) { pHand.push(deck.pop()); moves++; updateUI(); }
        }

        function handleDrop() {
            let p = (moves === 0) ? 20 : 40;
            if (confirm(`Drop this hand for ${p} points?`)) { pPool += p; init(); }
        }

        function groupCards() {
            if (selected.length < 2) return;
            let moving = [];
            selected.sort((a,b) => b-a).forEach(idx => moving.push(pHand.splice(idx, 1)[0]));
            pHand = [...moving.reverse(), ...pHand];
            selected = [];
            updateUI();
        }

        function autoSort() {
            pHand.sort((a,b) => a.s.localeCompare(b.s) || b.v - a.v);
            updateUI();
        }

        function declareShow() {
            if (pHand.length < 14) return alert("Draw a card first!");
            if (confirm("Show Valid? (Requires Pure Sequence)")) {
                let p = Math.floor(Math.random() * 50) + 20; bPool += p;
            } else { pPool += 80; }
            init();
        }

        init();
    </script>
</body>
</html>