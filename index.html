<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Friendly Rummy | Santosh AI</title>
    <style>
        :root { --felt: #1a472a; --gold: #f1c40f; --card-w: 62px; --card-h: 90px; }
        body { background: #0a2113; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; }

        /* --- HOME PAGE --- */
        #home-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #2a633d 0%, #0a2113 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 2000; text-align: center; padding: 20px;
        }
        .main-title { font-size: 3.2rem; color: var(--gold); margin: 0; text-shadow: 0 4px 15px rgba(0,0,0,0.6); font-weight: 800; }
        .sub-title { font-size: 1.2rem; color: #ddd; margin: 10px 0 40px 0; max-width: 500px; line-height: 1.4; font-style: italic; }
        
        /* Santosh AI Avatar on Home */
        .ai-profile { background: rgba(0,0,0,0.3); padding: 20px; border-radius: 20px; border: 1px solid rgba(241, 196, 15, 0.3); margin-bottom: 30px; }
        .bot-face { width: 70px; height: 55px; background: #34495e; border-radius: 12px; margin: 0 auto 10px; position: relative; border: 2px solid #222; }
        .bot-face::before, .bot-face::after { content: ''; position: absolute; width: 8px; height: 8px; background: #00ffcc; border-radius: 50%; top: 15px; box-shadow: 0 0 8px #00ffcc; }
        .bot-face::before { left: 15px; } .bot-face::after { right: 15px; }

        .last-score { font-size: 0.9rem; color: var(--gold); margin-bottom: 20px; font-weight: bold; }

        .menu-btn { 
            width: 240px; padding: 16px; margin: 10px; border: none; border-radius: 50px;
            background: var(--gold); color: #1a472a; font-weight: bold; font-size: 1.1rem;
            cursor: pointer; box-shadow: 0 6px 20px rgba(0,0,0,0.4); transition: 0.3s;
        }
        .menu-btn:hover { transform: translateY(-3px); filter: brightness(1.1); }

        /* --- GAME INTERFACE --- */
        #game-ui { display: none; flex-direction: column; align-items: center; height: 100vh; width: 100%; }
        #top-nav {
            width: 100%; padding: 12px 25px; display: flex; justify-content: space-between; 
            align-items: center; background: rgba(0,0,0,0.4); border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .home-btn { background: none; border: 1.5px solid var(--gold); color: var(--gold); padding: 8px 18px; border-radius: 20px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .home-btn:hover { background: var(--gold); color: #1a472a; }

        /* --- CIRCULAR TABLE --- */
        .table-3d { 
            position: relative; width: 500px; height: 320px; margin-top: 40px;
            background: radial-gradient(circle, #2a633d 0%, #1a472a 75%, #0b2415 100%);
            border: 12px solid #3d2b1f; border-radius: 50%;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.9), 0 20px 60px rgba(0,0,0,0.7);
            display: flex; justify-content: center; align-items: center;
        }
        .deck-area { display: flex; gap: 40px; position: relative; }
        .joker-card { position: absolute; left: -15px; top: 8px; transform: rotate(-90deg); z-index: 1; border: 2px solid var(--gold) !important; }

        /* --- HAND & GROUPS --- */
        #hand-groups { display: flex; gap: 15px; margin-top: 40px; }
        .group-slot { display: flex; background: rgba(0,0,0,0.25); border-radius: 10px; padding: 15px 8px; min-width: 70px; border: 1px solid rgba(255,255,255,0.05); }
        .card { 
            width: var(--card-w); height: var(--card-h); background: white; border-radius: 6px; color: black; 
            position: relative; display: flex; flex-direction: column; justify-content: space-between; padding: 6px; 
            box-sizing: border-box; box-shadow: 2px 4px 8px rgba(0,0,0,0.5); cursor: pointer; font-weight: bold; 
            margin-left: -35px; border: 1px solid #ccc;
        }
        .card:first-child { margin-left: 0; }
        .card.red { color: #d40000; }
        .card.selected { transform: translateY(-30px); border: 2.5px solid var(--gold); box-shadow: 0 10px 20px rgba(0,0,0,0.6); }
        .card.back { background: #2c3e50; border: 2px solid white; background-image: radial-gradient(#fff 10%, transparent 11%); background-size: 8px 8px; z-index: 5; }

        .controls { display: flex; gap: 12px; margin-top: 25px; }
        .action-btn { padding: 12px 24px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; background: var(--gold); color: #1a472a; }
    </style>
</head>
<body>

    <div id="home-screen">
        <div class="ai-profile">
            <div class="bot-face"></div>
            <p style="margin:0; font-weight:bold; color:var(--gold);">SANTOSH AI</p>
            <p style="margin:0; font-size:0.7rem; color:#aaa;">Level: Grandmaster</p>
        </div>

        <h1 class="main-title">Friendly Rummy</h1>
        <p class="sub-title">Play with <strong>Santosh AI</strong> to test your rummy skills and master the 201 Pool tournament format.</p>
        
        <div id="last-record" class="last-score"></div>

        <button class="menu-btn" onclick="launchGame()">PLAY MATCH</button>
        <button class="menu-btn" style="background:transparent; border:1px solid var(--gold); color:var(--gold);" onclick="showRules()">HOW TO PLAY</button>
    </div>

    <div id="game-ui">
        <div id="top-nav">
            <button class="home-btn" onclick="exitToHome()">üè† HOME</button>
            <div id="match-score" style="font-weight: bold; color: var(--gold);">You: 0 | Santosh: 0</div>
            <div style="font-size: 0.8rem; opacity: 0.8;">201 Pool Tournament</div>
        </div>

        <div class="table-3d">
            <div class="deck-area">
                <div id="wj-card" class="card joker-card"></div>
                <div class="card back" onclick="draw('deck')"></div>
                <div id="discard-p" class="card" onclick="draw('discard')"></div>
            </div>
        </div>

        <div id="hand-groups">
            <div class="group-slot" id="g0" ondrop="drop(event, 0)" ondragover="allow(event)"></div>
            <div class="group-slot" id="g1" ondrop="drop(event, 1)" ondragover="allow(event)"></div>
            <div class="group-slot" id="g2" ondrop="drop(event, 2)" ondragover="allow(event)"></div>
            <div class="group-slot" id="g3" ondrop="drop(event, 3)" ondragover="allow(event)"></div>
        </div>

        <div class="controls">
            <button class="action-btn" onclick="organize()">ü™Ñ 3-3-3-4</button>
            <button class="action-btn" style="background:#e67e22; color:white;" onclick="doDiscard()">üóëÔ∏è DISCARD</button>
            <button class="action-btn" style="background:#27ae60; color:white;" onclick="doShow()">üèÅ SHOW</button>
        </div>
    </div>

    <script>
        const suits = ['‚ô•', '‚ô¶', '‚ô£', '‚ô†'], ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
        let groups = [[], [], [], []], deck = [], discard = [], wildJoker = null, selected = null, pScore = 0, sScore = 0;

        window.onload = () => {
            const last = localStorage.getItem('last_rummy_score');
            if(last) document.getElementById('last-record').innerText = `Last Match: ${last}`;
        };

        function launchGame() {
            document.getElementById('home-screen').style.display = 'none';
            document.getElementById('game-ui').style.display = 'flex';
            resetRound();
        }

        function exitToHome() {
            if(confirm("Exit to dashboard? Your current round score will be lost.")) {
                localStorage.setItem('last_rummy_score', `You ${pScore} - ${sScore} Santosh`);
                location.reload();
            }
        }

        function resetRound() {
            deck = [];
            for(let s of suits) for(let r of ranks) deck.push({r, s, c:(s==='‚ô•'||s==='‚ô¶')?'red':'black'});
            deck.sort(() => Math.random() - 0.5);
            wildJoker = deck.pop();
            let fullHand = deck.splice(0, 13);
            groups = [fullHand.splice(0,3), fullHand.splice(0,3), fullHand.splice(0,3), fullHand];
            discard = [deck.pop()];
            render();
        }

        function render() {
            document.getElementById('match-score').innerText = `You: ${pScore} | Santosh: ${sScore}`;
            const wj = document.getElementById('wj-card');
            wj.className = `card joker-card ${wildJoker.c}`;
            wj.innerHTML = `<span>${wildJoker.r}<br>${wildJoker.s}</span>`;
            
            const dp = document.getElementById('discard-p');
            const top = discard[discard.length-1];
            dp.className = `card ${top.c}`;
            dp.innerHTML = `<span>${top.r}<br>${top.s}</span>`;

            groups.forEach((group, gIdx) => {
                const zone = document.getElementById(`g${gIdx}`);
                zone.innerHTML = '';
                group.forEach((card, cIdx) => {
                    const div = document.createElement('div');
                    const isSel = selected?.g === gIdx && selected?.c === cIdx;
                    div.className = `card ${card.c} ${isSel ? 'selected' : ''}`;
                    div.draggable = true;
                    div.innerHTML = `<span>${card.r}<br>${card.s}</span><span style="align-self:flex-end; transform:rotate(180deg)">${card.r}<br>${card.s}</span>`;
                    div.onclick = () => { selected = {g: gIdx, c: cIdx}; render(); };
                    div.ondragstart = (e) => { e.dataTransfer.setData("text", JSON.stringify({gIdx, cIdx})); };
                    zone.appendChild(div);
                });
            });
        }

        function allow(e) { e.preventDefault(); }
        function drop(e, targetGIdx) {
            e.preventDefault();
            const data = JSON.parse(e.dataTransfer.getData("text"));
            const card = groups[data.gIdx].splice(data.cIdx, 1)[0];
            groups[targetGIdx].push(card);
            render();
        }

        function draw(src) {
            if(groups.flat().length >= 14) return;
            groups[3].push(src === 'deck' ? deck.pop() : discard.pop());
            render();
        }

        function doDiscard() {
            if(!selected) return;
            discard.push(groups[selected.g].splice(selected.c, 1)[0]);
            selected = null; render();
            // Simple AI turn
            setTimeout(() => { discard.push(deck.pop()); render(); }, 600);
        }

        function organize() {
            let flat = groups.flat();
            groups = [flat.splice(0,3), flat.splice(0,3), flat.splice(0,3), flat];
            render();
        }

        function doShow() {
            if(confirm("Valid Pure Sequence?")) { sScore += 40; } else { pScore += 80; }
            if(pScore >= 201 || sScore >= 201) { 
                alert(pScore >= 201 ? "Santosh Wins!" : "You Win!"); 
                exitToHome(); 
            } else { resetRound(); }
        }

        function showRules() {
            alert("1. Create 3-3-3-4 groups.\n2. One PURE sequence is required (No Joker).\n3. Match continues until someone hits 201 points.");
        }
    </script>
</body>
</html>