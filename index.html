<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendly Rummy | Santosh Pro Tournament</title>
    <style>
        :root { --felt: #1a472a; --gold: #f1c40f; --card-w: 62px; --card-h: 90px; }
        body { background: var(--felt); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }

        /* --- UI & SCOREBOARD --- */
        #score-panel { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.9); border: 2px solid var(--gold); border-radius: 12px; width: 220px; max-height: 200px; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; text-align: center; }
        th { background: var(--gold); color: #1a472a; padding: 5px; position: sticky; top: 0; }
        td { padding: 6px; border-bottom: 1px solid #444; }
        .total-row { background: #333; font-weight: bold; color: var(--gold); }

        /* --- SANTOSH THE BOT --- */
        #santosh-zone { margin-top: 10px; text-align: center; display: flex; flex-direction: column; align-items: center; }
        .bubble { background: white; color: black; padding: 8px 15px; border-radius: 15px; font-size: 0.85rem; font-weight: bold; margin-bottom: 8px; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .bot-head { width: 60px; height: 45px; background: #34495e; border-radius: 10px; position: relative; border: 2px solid #222; }
        .eye { position: absolute; width: 7px; height: 7px; background: #00ffcc; border-radius: 50%; top: 15px; box-shadow: 0 0 8px #00ffcc; }
        .eye.left { left: 12px; } .eye.right { right: 12px; }

        /* --- GAME TABLE --- */
        .table { width: 90%; height: 240px; border: 10px solid #0b2415; border-radius: 120px; display: flex; justify-content: center; align-items: center; margin: 15px; background: radial-gradient(circle, #245c36, #1a472a); box-shadow: inset 0 0 60px black; position: relative; }
        .wild-joker-slot { position: absolute; left: 10%; top: 40%; transform: rotate(-90deg); z-index: 1; }

        /* --- CARDS --- */
        .card { width: var(--card-w); height: var(--card-h); background: white; border-radius: 6px; color: black; position: relative; display: flex; flex-direction: column; justify-content: space-between; padding: 5px; box-sizing: border-box; box-shadow: 2px 4px 8px rgba(0,0,0,0.4); margin-left: -32px; border: 1px solid #ccc; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .card:first-child { margin-left: 0; }
        .card.red { color: #d40000; }
        .card.selected { transform: translateY(-35px); border: 3px solid var(--gold); z-index: 50; }
        .card.spacer { margin-right: 35px !important; }
        .card.back { background: #2c3e50; border: 1.5px solid white; background-image: radial-gradient(#fff 10%, transparent 11%); background-size: 8px 8px; }
        .card.is-joker::after { content: '‚òÖ'; position: absolute; top: 2px; right: 2px; color: var(--gold); font-size: 0.7rem; }

        /* --- CONTROLS --- */
        .hand { display: flex; justify-content: center; padding: 25px; min-height: 130px; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; }
        button { padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; background: var(--gold); color: #2c3e50; }
        .btn-show { background: #27ae60; color: white; }
        
        /* --- ANIMATIONS --- */
        #deal-anim-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2000; }
        @keyframes dealOut { from { top: 40%; left: 50%; opacity: 1; } to { top: 80%; opacity: 0; } }
    </style>
</head>
<body>

    <div id="score-panel">
        <table>
            <thead><tr><th>Rnd</th><th>You</th><th>Santosh</th></tr></thead>
            <tbody id="score-body"></tbody>
            <tfoot><tr class="total-row"><td>TOT</td><td id="tot-p">0</td><td id="tot-s">0</td></tr></tfoot>
        </table>
    </div>

    <div id="santosh-zone">
        <div class="bubble" id="chat">Namaste! I'm Santosh.</div>
        <div class="bot-head"><div class="eye left"></div><div class="eye right"></div></div>
    </div>

    <div class="table">
        <div id="wj-area" class="wild-joker-slot"></div>
        <div style="display:flex; gap:30px;">
            <div class="card back" onclick="draw('deck')">Deck</div>
            <div id="discard-pile" class="card" onclick="draw('discard')">?</div>
        </div>
    </div>

    <div class="hand" id="hand-area"></div>

    <div class="controls">
        <button onclick="groupCards()">üì¶ Group</button>
        <button style="background:#e67e22; color:white;" onclick="discardAction()">üóëÔ∏è Discard</button>
        <button class="btn-show" onclick="handleShow()">üèÅ SHOW</button>
        <button style="background:#7f8c8d; color:white;" onclick="handleDrop()">üè≥Ô∏è Drop</button>
    </div>

    <script>
        const suits = ['‚ô•', '‚ô¶', '‚ô£', '‚ô†'], ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
        let pHand = [], deck = [], discard = [], wildJoker = null, selected = [], pTotal = 0, sTotal = 0, round = 1, moves = 0, spacers = [];

        function save() { localStorage.setItem('rummy_save', JSON.stringify({pTotal, sTotal, round})); }

        function init() {
            const saved = JSON.parse(localStorage.getItem('rummy_save'));
            if(saved && round === 1) { pTotal = saved.pTotal; sTotal = saved.sTotal; round = saved.round; }
            
            deck = [];
            for(let s of suits) for(let r of ranks) deck.push({r, s, c:(s==='‚ô•'||s==='‚ô¶')?'red':'black'});
            deck.sort(() => Math.random() - 0.5);
            
            wildJoker = deck.pop();
            pHand = deck.splice(0, 13);
            discard = [deck.pop()];
            moves = 0; selected = []; spacers = [];
            render();
        }

        function render() {
            const area = document.getElementById('hand-area'); area.innerHTML = '';
            pHand.forEach((c, i) => {
                const div = document.createElement('div');
                div.className = `card ${c.c} ${selected.includes(i)?'selected':''} ${spacers.includes(i)?'spacer':''} ${c.r===wildJoker.r?'is-joker':''}`;
                div.innerHTML = `<span>${c.r}<br>${c.s}</span><span style="align-self:flex-end; transform:rotate(180deg)">${c.r}<br>${c.s}</span>`;
                div.onclick = () => { selected.includes(i)?selected=selected.filter(x=>x!==i):selected.push(i); render(); };
                area.appendChild(div);
            });
            const top = discard[discard.length-1];
            document.getElementById('discard-pile').className = `card ${top.c} ${top.r===wildJoker.r?'is-joker':''}`;
            document.getElementById('discard-pile').innerHTML = `<span>${top.r}<br>${top.s}</span>`;
            
            const wjArea = document.getElementById('wj-area');
            wjArea.innerHTML = `<div class="card ${wildJoker.c}"><span>${wildJoker.r}<br>${wildJoker.s}</span></div>`;

            document.getElementById('tot-p').innerText = pTotal;
            document.getElementById('tot-s').innerText = sTotal;
        }

        function draw(src) {
            if(pHand.length < 14) {
                pHand.push(src === 'deck' ? deck.pop() : discard.pop());
                moves++; render();
            }
        }

        function discardAction() {
            if(selected.length !== 1 || pHand.length < 14) return;
            discard.push(pHand.splice(selected[0], 1)[0]);
            selected = []; render();
            setTimeout(() => { discard.push(deck.pop()); render(); }, 800);
        }

        function groupCards() {
            if(selected.length < 2) return;
            let moving = [];
            selected.sort((a,b)=>b-a).forEach(idx => moving.push(pHand.splice(idx,1)[0]));
            pHand = [...moving.reverse(), ...pHand];
            spacers.push(moving.length - 1);
            selected = []; render();
        }

        function handleShow() {
            if(pHand.length < 14) return;
            let valid = confirm("Valid Pure Sequence + Second Sequence?");
            if(valid) { sTotal += 40; } else { pTotal += 80; }
            round++; save(); updateScoreTable(); init();
        }

        function handleDrop() {
            let pen = moves === 0 ? 20 : 40;
            if(confirm(`Drop for ${pen} points?`)) { pTotal += pen; round++; save(); updateScoreTable(); init(); }
        }

        function updateScoreTable() {
            const body = document.getElementById('score-body');
            const row = body.insertRow();
            row.innerHTML = `<td>${round-1}</td><td>-</td><td>-</td>`;
            if(pTotal >= 201 || sTotal >= 201) { alert("Match Finished!"); localStorage.clear(); location.reload(); }
        }

        init();
    </script>
</body>
</html>